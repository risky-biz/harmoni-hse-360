import{h as E,i as H,j as e,F as i,A as r,C as $}from"./index-CEPkdG4-.js";import{u as G,c as U,r as l}from"./react-vendor-CTgry22P.js";import{g as _,a as Q}from"./incidentUtils-Bj1-pRjt.js";import{u as V,x as D,y as d,A as X,B as W,b as m,D as Y,v as M,G as q,I as J,Q as P,R as K,S as Z,T as k,U as c,V as ee,W as o,C as se,a as te,c as ie,f as u,X as ne,Y as S}from"./coreui-vendor-BHlqdV6q.js";import{f as z}from"./dateUtils-BKWPuADf.js";import"./redux-vendor-CopoOshl.js";const me=()=>{const x=G(),j=U(),[p,b]=l.useState(""),[g,w]=l.useState(""),[C,T]=l.useState(""),[n,h]=l.useState(1),[v]=l.useState(10),[I,y]=l.useState(null),{data:t,error:f,isLoading:O,refetch:A}=E({pageNumber:n,pageSize:v,status:g||void 0,severity:C||void 0,searchTerm:p||void 0},{refetchOnMountOrArgChange:!0,refetchOnFocus:!0}),[B,{isLoading:L}]=H(),F=(t==null?void 0:t.incidents)||[],R=(t==null?void 0:t.totalCount)||0,N=(t==null?void 0:t.totalPages)||0;return l.useEffect(()=>{var s;if((s=j.state)!=null&&s.message){y(j.state.message),window.history.replaceState({},document.title);const a=setTimeout(()=>y(null),5e3);return()=>clearTimeout(a)}},[j.state]),O?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(V,{size:"sm",className:"text-primary"}),e.jsx("span",{className:"ms-2",children:"Loading incidents..."})]}):e.jsx(D,{children:e.jsx(d,{xs:12,children:e.jsxs(X,{className:"shadow-sm",children:[e.jsxs(W,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",style:{color:"var(--harmoni-charcoal)",fontFamily:"Poppins, sans-serif"},children:"Incident Reports"}),e.jsx("small",{className:"text-muted",children:"Manage and track all incident reports"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(m,{color:"secondary",variant:"outline",onClick:()=>{console.log("Manual refresh triggered"),A()},title:"Refresh incident list",children:"ðŸ”„ Refresh"}),e.jsxs(m,{color:"primary",onClick:()=>x("/incidents/create"),className:"d-flex align-items-center",children:[e.jsx(i,{icon:r.create,size:"sm",className:"me-2"}),"Report Incident"]})]})]}),e.jsxs(Y,{children:[I&&e.jsx(M,{color:"success",dismissible:!0,onClose:()=>y(null),children:I}),f&&e.jsx(M,{color:"danger",dismissible:!0,onClose:()=>A(),children:typeof f=="string"?f:"Failed to load incidents. Please try again."}),e.jsxs(D,{className:"mb-4",children:[e.jsx(d,{md:4,children:e.jsxs(q,{children:[e.jsx(J,{placeholder:"Search incidents...",value:p,onChange:s=>b(s.target.value)}),e.jsx(m,{type:"button",color:"primary",variant:"outline",children:e.jsx(i,{icon:r.search})})]})}),e.jsx(d,{md:3,children:e.jsxs(P,{value:g,onChange:s=>w(s.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"Reported",children:"Reported"}),e.jsx("option",{value:"UnderInvestigation",children:"Under Investigation"}),e.jsx("option",{value:"AwaitingAction",children:"Awaiting Action"}),e.jsx("option",{value:"Resolved",children:"Resolved"}),e.jsx("option",{value:"Closed",children:"Closed"})]})}),e.jsx(d,{md:3,children:e.jsxs(P,{value:C,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"",children:"All Severities"}),e.jsx("option",{value:"Minor",children:"Minor"}),e.jsx("option",{value:"Moderate",children:"Moderate"}),e.jsx("option",{value:"Serious",children:"Serious"}),e.jsx("option",{value:"Critical",children:"Critical"})]})}),e.jsx(d,{md:2,children:e.jsxs(m,{color:"secondary",variant:"outline",className:"w-100",onClick:()=>{b(""),w(""),T(""),h(1)},children:[e.jsx(i,{icon:r.cancel,size:"sm",className:"me-2"}),"Clear"]})})]}),F.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(i,{icon:$.incident,className:"text-muted mb-3",style:{fontSize:"3rem"}}),e.jsx("h5",{className:"text-muted",children:"No incidents found"}),e.jsx("p",{className:"text-muted",children:p||g||C?"Try adjusting your filters or search criteria.":"No incidents have been reported yet."}),e.jsxs(m,{color:"primary",onClick:()=>x("/incidents/create"),className:"mt-3",children:[e.jsx(i,{icon:r.create,size:"sm",className:"me-2"}),"Report First Incident"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(K,{responsive:!0,hover:!0,children:[e.jsx(Z,{children:e.jsxs(k,{children:[e.jsx(c,{scope:"col",children:"Title"}),e.jsx(c,{scope:"col",children:"Severity"}),e.jsx(c,{scope:"col",children:"Status"}),e.jsx(c,{scope:"col",children:"Location"}),e.jsx(c,{scope:"col",children:"Reporter"}),e.jsx(c,{scope:"col",children:"Date"}),e.jsx(c,{scope:"col",children:"Actions"})]})}),e.jsx(ee,{children:F.map(s=>e.jsxs(k,{children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.title}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.description.length>50?`${s.description.substring(0,50)}...`:s.description})]})}),e.jsx(o,{children:_(s.severity)}),e.jsx(o,{children:Q(s.status)}),e.jsx(o,{children:s.location}),e.jsx(o,{children:s.reporterName}),e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("small",{children:z(s.incidentDate)}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Reported: ",z(s.createdAt)]})]})}),e.jsx(o,{children:e.jsxs(se,{children:[e.jsx(te,{color:"light",size:"sm",caret:!1,children:e.jsx(i,{icon:r.menu})}),e.jsxs(ie,{children:[e.jsxs(u,{onClick:()=>x(`/incidents/${s.id}`),children:[e.jsx(i,{icon:r.view,size:"sm",className:"me-2"}),"View Details"]}),e.jsxs(u,{onClick:()=>x(`/incidents/${s.id}/edit`),children:[e.jsx(i,{icon:r.edit,size:"sm",className:"me-2"}),"Edit"]}),e.jsx(u,{style:{borderTop:"1px solid #dee2e6"}}),e.jsxs(u,{className:"text-danger",onClick:async()=>{if(window.confirm(`Are you sure you want to delete "${s.title}"? This action cannot be undone.`))try{await B(s.id).unwrap()}catch(a){console.error("Failed to delete incident:",a),alert("Failed to delete incident. Please try again.")}},disabled:L,children:[e.jsx(i,{icon:r.delete,size:"sm",className:"me-2"}),"Delete"]})]})]})})]},s.id))})]}),N>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(n-1)*v+1," to ",Math.min(n*v,R)," of ",R," incidents"]}),e.jsxs(ne,{"aria-label":"Incidents pagination",children:[e.jsx(S,{disabled:n===1,onClick:()=>h(n-1),children:"Previous"}),[...Array(N)].map((s,a)=>e.jsx(S,{active:n===a+1,onClick:()=>h(a+1),children:a+1},a+1)),e.jsx(S,{disabled:n===N,onClick:()=>h(n+1),children:"Next"})]})]})]})]})]})})})};export{me as default};
