import{S as A,T as L,j as e,U as p,V as k}from"./index-CEPkdG4-.js";import{h as M,u as w,r as q}from"./react-vendor-CTgry22P.js";import{u as D}from"./index.esm-Drw8RU7c.js";import{I as c}from"./Icon-B4fkNQKE.js";import{A as P}from"./AttachmentManager-fKN8oFv1.js";import{a as m}from"./dateUtils-BKWPuADf.js";import{u as v,v as g,b as x,x as h,y as n,A as R,B,D as E,F as U,Z as d,I as T,_ as G,Q as u}from"./coreui-vendor-BHlqdV6q.js";import"./redux-vendor-CopoOshl.js";const Z=()=>{const{id:t}=M(),l=w(),{data:s,error:b,isLoading:y}=A(Number(t)),[f,{isLoading:o,error:N}]=L(),C=["Main Building - Ground Floor","Main Building - 1st Floor","Main Building - 2nd Floor","Science Wing - Chemistry Lab","Science Wing - Physics Lab","Science Wing - Biology Lab","Library - Main Hall","Library - Study Rooms","Gymnasium - Main Court","Gymnasium - Equipment Room","Cafeteria - Dining Area","Cafeteria - Kitchen","Playground - Primary","Playground - Secondary","Swimming Pool Area","Parking Area","Sports Field","Other (specify in description)"],{register:a,handleSubmit:S,formState:{errors:i},reset:j}=D();q.useEffect(()=>{s&&j({title:s.title,description:s.description,severity:s.severity,status:s.status,location:s.location})},[s,j]);const F=async r=>{try{await f({id:Number(t),incident:{...r,severity:r.severity,status:r.status}}).unwrap(),l(`/incidents/${t}`)}catch(I){console.error("Failed to update incident:",I)}};return y?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(v,{size:"sm",className:"text-primary"}),e.jsx("span",{className:"ms-2",children:"Loading incident..."})]}):b||!s?e.jsxs(g,{color:"danger",children:["Failed to load incident. Please try again.",e.jsx("div",{className:"mt-3",children:e.jsxs(x,{color:"primary",onClick:()=>l("/incidents"),children:[e.jsx(c,{icon:p,className:"me-2"}),"Back to List"]})})]}):e.jsx(h,{children:e.jsxs(n,{xs:12,children:[e.jsxs(R,{className:"shadow-sm",children:[e.jsx(B,{children:e.jsx("h4",{className:"mb-0",children:"Edit Incident"})}),e.jsxs(E,{children:[N&&e.jsx(g,{color:"danger",dismissible:!0,children:"Failed to update incident. Please try again."}),e.jsxs(U,{onSubmit:S(F),children:[e.jsxs(h,{children:[e.jsxs(n,{md:8,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{htmlFor:"title",children:"Title *"}),e.jsx(T,{id:"title",type:"text",...a("title",{required:"Title is required"}),invalid:!!i.title}),i.title&&e.jsx("div",{className:"invalid-feedback d-block",children:i.title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{htmlFor:"description",children:"Description *"}),e.jsx(G,{id:"description",rows:4,...a("description",{required:"Description is required"}),invalid:!!i.description}),i.description&&e.jsx("div",{className:"invalid-feedback d-block",children:i.description.message})]}),e.jsxs(h,{children:[e.jsx(n,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{htmlFor:"severity",children:"Severity *"}),e.jsxs(u,{id:"severity",...a("severity",{required:"Severity is required"}),invalid:!!i.severity,children:[e.jsx("option",{value:"Minor",children:"Minor"}),e.jsx("option",{value:"Moderate",children:"Moderate"}),e.jsx("option",{value:"Serious",children:"Serious"}),e.jsx("option",{value:"Critical",children:"Critical"})]}),i.severity&&e.jsx("div",{className:"invalid-feedback d-block",children:i.severity.message})]})}),e.jsx(n,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{htmlFor:"status",children:"Status *"}),e.jsxs(u,{id:"status",...a("status",{required:"Status is required"}),invalid:!!i.status,children:[e.jsx("option",{value:"Reported",children:"Reported"}),e.jsx("option",{value:"UnderInvestigation",children:"Under Investigation"}),e.jsx("option",{value:"AwaitingAction",children:"Awaiting Action"}),e.jsx("option",{value:"Resolved",children:"Resolved"}),e.jsx("option",{value:"Closed",children:"Closed"})]}),i.status&&e.jsx("div",{className:"invalid-feedback d-block",children:i.status.message})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(d,{htmlFor:"location",children:"Location *"}),e.jsxs(u,{id:"location",...a("location",{required:"Location is required"}),invalid:!!i.location,children:[e.jsx("option",{value:"",children:"Select location..."}),C.map(r=>e.jsx("option",{value:r,children:r},r))]}),i.location&&e.jsx("div",{className:"invalid-feedback d-block",children:i.location.message})]})]}),e.jsx(n,{md:4,children:e.jsxs("div",{className:"border-start ps-4",children:[e.jsx("h6",{className:"text-muted mb-3",children:"Incident Information"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"ID:"})," ",s.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Incident Date:"})," ",m(s.incidentDate)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Reporter:"})," ",s.reporterName]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Created:"})," ",m(s.createdAt)]}),s.lastModifiedAt&&e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:"Last Modified:"})," ",m(s.lastModifiedAt)]})]})})]}),e.jsx("hr",{}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(x,{color:"light",onClick:()=>l(`/incidents/${t}`),disabled:o,children:[e.jsx(c,{icon:p,className:"me-2"}),"Cancel"]}),e.jsx(x,{color:"primary",type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:"sm",className:"me-2"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{icon:k,className:"me-2"}),"Save Changes"]})})]})]})]})]}),e.jsx(P,{incidentId:Number(t),allowUpload:!0,allowDelete:!0})]})})};export{Z as default};
