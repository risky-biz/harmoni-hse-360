import{o as me,j as e,p as ue,q as he,r as ae,t as ve,v as pe,w as ge,x as Ne,y as ye,F as v,C as U,A as T,z as fe,B as K,D as Ce,E as be,G as Ae,H as Ie,I as we,J as De,K as Te,L as Pe,M as Se,N as Me,O as ke,i as Fe,P as ze,Q as Ee,R as Re}from"./index-CEPkdG4-.js";import{r as j,h as Be,u as Ue}from"./react-vendor-CTgry22P.js";import{I as A}from"./Icon-B4fkNQKE.js";import{$ as _,a0 as Y,a1 as L,a2 as J,v as Z,a3 as $,a4 as I,b as h,F as xe,x as C,y as d,Z as b,G as Ve,H as Oe,I as X,Q as V,_ as re,u as z,a5 as je,r as P,A as O,B as H,D as G,K as He}from"./coreui-vendor-BHlqdV6q.js";import{a as le,b as Ge,f as ne}from"./dateUtils-BKWPuADf.js";import{A as $e}from"./AttachmentManager-fKN8oFv1.js";import{a as We,g as qe}from"./incidentUtils-Bj1-pRjt.js";import"./redux-vendor-CopoOshl.js";const Qe=({visible:a,onClose:c,involvedPersons:p,onAdd:g,onUpdate:l,onRemove:N})=>{var B;const[n,o]=j.useState(null),[t,w]=j.useState("Witness"),[S,M]=j.useState(""),[D,E]=j.useState(!1),[k,R]=j.useState(""),[u,y]=j.useState(!1),[r,x]=j.useState(null),{data:f,isLoading:ee}=me(k),se=(f==null?void 0:f.filter(i=>!p.some(Q=>Q.person.id===i.id)))||[],te=async()=>{if(n){y(!0),x(null);try{await g(n,t,S||void 0),F()}catch{x("Failed to add involved person. Please try again.")}finally{y(!1)}}},s=async()=>{if(n){y(!0),x(null);try{await l(n,t,S||void 0),F()}catch{x("Failed to update involved person. Please try again.")}finally{y(!1)}}},m=async i=>{if(confirm("Are you sure you want to remove this person?")){y(!0),x(null);try{await N(i)}catch{x("Failed to remove involved person. Please try again.")}finally{y(!1)}}},W=i=>{o(i.person.id),w(i.involvementType),M(i.injuryDescription||""),E(!0)},F=()=>{o(null),w("Witness"),M(""),E(!1),R("")},q=i=>{const Q={Witness:"info",Victim:"danger",FirstResponder:"success"};return e.jsx(P,{color:Q[i]||"secondary",children:i})};return j.useEffect(()=>{a||(F(),x(null))},[a]),e.jsxs(_,{visible:a,onClose:c,size:"lg",children:[e.jsx(Y,{children:e.jsx(L,{children:"Manage Involved Persons"})}),e.jsxs(J,{children:[r&&e.jsx(Z,{color:"danger",dismissible:!0,onClose:()=>x(null),children:r}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"mb-3",children:["Current Involved Persons (",p.length,")"]}),e.jsx($,{children:p.length===0?e.jsx(I,{children:e.jsx("em",{className:"text-muted",children:"No persons involved in this incident yet."})}):p.map(i=>e.jsxs(I,{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold",children:i.person.fullName}),e.jsx("div",{className:"text-muted small",children:i.person.email}),i.injuryDescription&&e.jsx("div",{className:"mt-1",children:e.jsxs("small",{className:"text-danger",children:[e.jsx(A,{icon:ue})," ",i.injuryDescription]})})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[q(i.involvementType),e.jsx(h,{color:"primary",variant:"ghost",size:"sm",onClick:()=>W(i),disabled:u,children:e.jsx(A,{icon:he})}),e.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>m(i.person.id),disabled:u,children:e.jsx(A,{icon:ae})})]})]},i.person.id))})]}),e.jsxs("div",{className:"border-top pt-4",children:[e.jsx("h6",{className:"mb-3",children:D?"Edit Involved Person":"Add Involved Person"}),e.jsxs(xe,{children:[e.jsxs(C,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Person"}),D?e.jsx(X,{value:((B=p.find(i=>i.person.id===n))==null?void 0:B.person.fullName)||"",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{className:"mb-2",children:[e.jsx(Oe,{children:e.jsx(A,{icon:ve})}),e.jsx(X,{type:"text",placeholder:"Search by name or email...",value:k,onChange:i=>R(i.target.value)})]}),e.jsxs(V,{value:n||"",onChange:i=>o(Number(i.target.value)),disabled:ee,children:[e.jsx("option",{value:"",children:"Select a person..."}),se.map(i=>e.jsxs("option",{value:i.id,children:[i.fullName," (",i.email,")"]},i.id))]})]})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Involvement Type"}),e.jsxs(V,{value:t,onChange:i=>w(i.target.value),children:[e.jsx("option",{value:"Witness",children:"Witness"}),e.jsx("option",{value:"Victim",children:"Victim"}),e.jsx("option",{value:"FirstResponder",children:"First Responder"})]})]})})]}),t==="Victim"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Injury Description"}),e.jsx(re,{rows:3,value:S,onChange:i=>M(i.target.value),placeholder:"Describe any injuries sustained..."})]}),e.jsx("div",{className:"d-flex gap-2",children:D?e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"primary",onClick:s,disabled:u||!n,children:u?e.jsx(z,{size:"sm"}):"Update Person"}),e.jsx(h,{color:"secondary",onClick:F,disabled:u,children:"Cancel"})]}):e.jsx(h,{color:"primary",onClick:te,disabled:u||!n,children:u?e.jsx(z,{size:"sm"}):"Add Person"})})]})]})]}),e.jsx(je,{children:e.jsx(h,{color:"secondary",onClick:c,children:"Close"})})]})},de={Low:{color:"secondary",label:"Low"},Medium:{color:"info",label:"Medium"},High:{color:"warning",label:"High"},Critical:{color:"danger",label:"Critical"}},ce={Pending:{color:"secondary",label:"Pending"},InProgress:{color:"info",label:"In Progress"},Completed:{color:"success",label:"Completed"},Overdue:{color:"danger",label:"Overdue"}},oe=({incidentId:a,allowEdit:c=!0})=>{const[p,g]=j.useState(!1),[l,N]=j.useState(null),[n,o]=j.useState({description:"",assignedToDepartment:"",assignedToId:void 0,dueDate:"",priority:"Medium",status:"Pending",completionNotes:""}),[t]=j.useState(""),{data:w=[],isLoading:S,error:M}=pe(a),{data:D=[]}=me(t),[E,{isLoading:k}]=ge(),[R,{isLoading:u}]=Ne(),[y,{isLoading:r}]=ye(),x=s=>{var m;s?(N(s),o({description:s.description,assignedToDepartment:s.assignedToDepartment,assignedToId:(m=s.assignedTo)==null?void 0:m.id,dueDate:s.dueDate.split("T")[0],priority:s.priority,status:s.status,completionNotes:s.completionNotes||""})):(N(null),o({description:"",assignedToDepartment:"",assignedToId:void 0,dueDate:"",priority:"Medium",status:"Pending",completionNotes:""})),g(!0)},f=()=>{g(!1),N(null)},ee=async s=>{s.preventDefault();try{if(l){const m={description:n.description,assignedToDepartment:n.assignedToDepartment,assignedToId:n.assignedToId,dueDate:n.dueDate,priority:n.priority,status:n.status,completionNotes:n.completionNotes};await R({incidentId:a,actionId:l.id,data:m}).unwrap()}else{const m={description:n.description,assignedToDepartment:n.assignedToDepartment,assignedToId:n.assignedToId,dueDate:n.dueDate,priority:n.priority};await E({incidentId:a,data:m}).unwrap()}f()}catch(m){console.error("Failed to save corrective action:",m)}},se=async s=>{if(confirm("Are you sure you want to delete this corrective action?"))try{await y({incidentId:a,actionId:s}).unwrap()}catch(m){console.error("Failed to delete corrective action:",m)}},te=(s,m)=>m!=="Completed"&&new Date(s)<new Date;return S?e.jsxs("div",{className:"d-flex justify-content-center p-4",children:[e.jsx(z,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading corrective actions..."})]}):M?e.jsx(Z,{color:"danger",children:"Failed to load corrective actions. Please try again."}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"mb-4",children:[e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(v,{icon:U.incident,className:"me-2"}),"Corrective Actions (",w.length,")"]}),c&&e.jsxs(h,{color:"primary",size:"sm",onClick:()=>x(),children:[e.jsx(v,{icon:T.create,className:"me-2"}),"Add Action"]})]}),e.jsx(G,{children:w.length===0?e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(v,{icon:U.incident,size:"2x",className:"mb-2 opacity-50"}),e.jsx("p",{className:"mb-0",children:"No corrective actions defined yet"}),c&&e.jsx("p",{className:"small",children:"Add corrective actions to track follow-up tasks"})]}):e.jsx($,{flush:!0,children:w.map(s=>{var m,W,F,q,B;return e.jsxs(I,{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx(P,{color:((m=ce[s.status])==null?void 0:m.color)||"secondary",className:"me-2",children:((W=ce[s.status])==null?void 0:W.label)||s.status}),e.jsx(P,{color:((F=de[s.priority])==null?void 0:F.color)||"secondary",className:"me-2",children:((q=de[s.priority])==null?void 0:q.label)||s.priority}),te(s.dueDate,s.status)&&e.jsx(P,{color:"danger",children:"OVERDUE"})]}),e.jsx("h6",{className:"mb-1",children:s.description}),e.jsxs("div",{className:"text-muted small",children:[e.jsxs("div",{children:["Assigned to: ",((B=s.assignedTo)==null?void 0:B.fullName)||s.assignedToDepartment]}),e.jsxs("div",{children:["Due: ",le(s.dueDate)]}),s.completedDate&&e.jsxs("div",{children:["Completed: ",le(s.completedDate)]}),s.completionNotes&&e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{children:"Notes:"})," ",s.completionNotes]})]})]}),c&&e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(h,{color:"primary",variant:"ghost",size:"sm",onClick:()=>x(s),disabled:r,children:e.jsx(v,{icon:T.edit})}),e.jsx(h,{color:"danger",variant:"ghost",size:"sm",onClick:()=>se(s.id),disabled:r,children:e.jsx(v,{icon:T.delete})})]})]},s.id)})})})]}),e.jsxs(_,{visible:p,onClose:f,size:"lg",children:[e.jsx(Y,{children:e.jsx(L,{children:l?"Edit Corrective Action":"Add Corrective Action"})}),e.jsxs(xe,{onSubmit:ee,children:[e.jsxs(J,{children:[e.jsx(C,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Description *"}),e.jsx(re,{rows:3,value:n.description,onChange:s=>o({...n,description:s.target.value}),placeholder:"Describe the corrective action required...",required:!0})]})})}),e.jsxs(C,{children:[e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Assigned Department *"}),e.jsx(X,{value:n.assignedToDepartment,onChange:s=>o({...n,assignedToDepartment:s.target.value}),placeholder:"e.g., Safety Department",required:!0})]})}),e.jsx(d,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Assigned Person (Optional)"}),e.jsxs(V,{value:n.assignedToId||"",onChange:s=>o({...n,assignedToId:s.target.value?Number(s.target.value):void 0}),children:[e.jsx("option",{value:"",children:"Select a person..."}),D.map(s=>e.jsxs("option",{value:s.id,children:[s.fullName," (",s.email,")"]},s.id))]})]})})]}),e.jsxs(C,{children:[e.jsx(d,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Due Date *"}),e.jsx(X,{type:"date",value:n.dueDate,onChange:s=>o({...n,dueDate:s.target.value}),min:new Date().toISOString().split("T")[0],required:!0})]})}),e.jsx(d,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Priority *"}),e.jsxs(V,{value:n.priority,onChange:s=>o({...n,priority:s.target.value}),required:!0,children:[e.jsx("option",{value:"Low",children:"Low"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"High",children:"High"}),e.jsx("option",{value:"Critical",children:"Critical"})]})]})}),l&&e.jsx(d,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Status"}),e.jsxs(V,{value:n.status,onChange:s=>o({...n,status:s.target.value}),children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"InProgress",children:"In Progress"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]})})]}),l&&n.status==="Completed"&&e.jsx(C,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(b,{children:"Completion Notes"}),e.jsx(re,{rows:3,value:n.completionNotes,onChange:s=>o({...n,completionNotes:s.target.value}),placeholder:"Describe how the action was completed..."})]})})})]}),e.jsxs(je,{children:[e.jsx(h,{color:"secondary",onClick:f,children:"Cancel"}),e.jsx(h,{color:"primary",type:"submit",disabled:k||u,children:k||u?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"sm",className:"me-2"}),l?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{icon:T.save,className:"me-2"}),l?"Update Action":"Create Action"]})})]})]})]})]})},Ke=a=>{switch(a){case"Created":return Me;case"Updated":return he;case"Viewed":return Se;case"Status Changed":case"Severity Changed":return Pe;case"Attachment Added":return Te;case"Attachment Removed":return ae;case"Corrective Action Added":case"Corrective Action Updated":return De;case"Corrective Action Removed":return ae;case"Involved Person Added":return we;case"Involved Person Removed":return Ie;case"Comment Added":return Ae;case"Exported":return be;default:return Ce}},ie=a=>{switch(a){case"Created":return"success";case"Updated":return"info";case"Status Changed":case"Severity Changed":return"warning";case"Attachment Added":case"Corrective Action Added":case"Involved Person Added":case"Comment Added":return"primary";case"Attachment Removed":case"Corrective Action Removed":case"Involved Person Removed":return"danger";case"Viewed":return"light";case"Exported":return"secondary";default:return"secondary"}},_e=a=>a.changeDescription?a.changeDescription:a.oldValue&&a.newValue?`Changed ${a.fieldName} from "${a.oldValue}" to "${a.newValue}"`:a.newValue&&!a.oldValue?`Set ${a.fieldName} to "${a.newValue}"`:a.oldValue&&!a.newValue?`Cleared ${a.fieldName} (was "${a.oldValue}")`:a.action,Ye=({incidentId:a})=>{const{data:c=[],isLoading:p,error:g}=fe(a);return p?e.jsxs(O,{className:"mb-4",children:[e.jsx(H,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(v,{icon:K,className:"me-2"}),"Activity History"]})}),e.jsx(G,{children:e.jsxs("div",{className:"d-flex justify-content-center p-4",children:[e.jsx(z,{size:"sm"}),e.jsx("span",{className:"ms-2",children:"Loading activity history..."})]})})]}):g?e.jsxs(O,{className:"mb-4",children:[e.jsx(H,{children:e.jsxs("h6",{className:"mb-0",children:[e.jsx(v,{icon:K,className:"me-2"}),"Activity History"]})}),e.jsx(G,{children:e.jsx(Z,{color:"danger",children:"Failed to load activity history. Please try again."})})]}):e.jsxs(O,{className:"mb-4",children:[e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx(v,{icon:K,className:"me-2"}),"Activity History (",c.length,")"]}),c.length>0&&e.jsxs("small",{className:"text-muted",children:["Last updated ",Ge(c[0].changedAt)]})]}),e.jsx(G,{children:c.length===0?e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx(v,{icon:K,size:"2x",className:"mb-2 opacity-50"}),e.jsx("p",{className:"mb-0",children:"No activity recorded yet"})]}):e.jsx($,{flush:!0,className:"audit-trail-mobile",children:c.map((l,N)=>e.jsx(I,{className:`border-start border-4 ${N===0?"border-primary":"border-light"}`,style:{borderLeftWidth:"3px !important"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3 mt-1",children:e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",backgroundColor:`var(--cui-${ie(l.action)})`,color:ie(l.action)==="light"?"var(--cui-dark)":"white"},children:e.jsx(v,{icon:Ke(l.action),size:"sm"})})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"text-dark",children:l.changedBy}),e.jsx(P,{color:ie(l.action),className:"ms-2",children:l.action})]}),e.jsx("small",{className:"text-muted",children:le(l.changedAt)})]}),e.jsx("div",{className:"text-muted",children:_e(l)}),l.fieldName!=="System"&&e.jsxs("small",{className:"text-muted",children:["Field: ",e.jsx("code",{children:l.fieldName})]})]})]})},l.id))})})]})},is=()=>{var u,y;const{id:a}=Be(),c=Ue(),[p,g]=j.useState(!1),[l,N]=j.useState(!1),[n,o]=j.useState(!1),{data:t,error:w,isLoading:S}=ke(Number(a)),[M,{isLoading:D}]=Fe(),[E]=ze(),[k]=Ee(),[R]=Re();return S?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(z,{size:"sm",className:"text-primary"}),e.jsx("span",{className:"ms-2",children:"Loading incident details..."})]}):w||!t?e.jsxs(Z,{color:"danger",children:["Failed to load incident details. Please try again.",e.jsx("div",{className:"mt-3",children:e.jsxs(h,{color:"primary",onClick:()=>c("/incidents"),children:[e.jsx(A,{icon:T.back,className:"me-2"}),"Back to List"]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{children:e.jsx(d,{xs:12,children:e.jsxs(O,{className:"shadow-sm",children:[e.jsxs(H,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:"Incident Details"}),e.jsxs("small",{className:"text-muted",children:["ID: ",t.id]})]}),e.jsxs("div",{children:[e.jsxs(h,{color:"light",className:"me-2",onClick:()=>c("/incidents"),children:[e.jsx(A,{icon:T.back,size:"sm",className:"me-2"}),"Back"]}),e.jsxs(h,{color:"primary",className:"me-2",onClick:()=>c(`/incidents/${a}/edit`),children:[e.jsx(A,{icon:T.edit,size:"sm",className:"me-2"}),"Edit"]}),e.jsx(h,{color:"danger",disabled:D,onClick:async()=>{if(window.confirm("Are you sure you want to delete this incident? This action cannot be undone."))try{await M(Number(a)).unwrap(),c("/incidents")}catch(r){console.error("Failed to delete incident:",r),alert("Failed to delete incident. Please try again.")}},children:D?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"sm",className:"me-2"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{icon:T.delete,size:"sm",className:"me-2"}),"Delete"]})})]})]}),e.jsx(G,{children:e.jsxs(C,{children:[e.jsxs(d,{md:8,children:[e.jsx("h5",{className:"mb-3",children:t.title}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted",children:"Description"}),e.jsx("p",{children:t.description})]}),e.jsxs(C,{className:"mb-4",children:[e.jsxs(d,{sm:6,children:[e.jsx("h6",{className:"text-muted",children:"Status"}),e.jsx("p",{children:We(t.status)})]}),e.jsxs(d,{sm:6,children:[e.jsx("h6",{className:"text-muted",children:"Severity"}),e.jsx("p",{children:qe(t.severity)})]})]}),e.jsxs(C,{className:"mb-4",children:[e.jsxs(d,{sm:6,children:[e.jsxs("h6",{className:"text-muted",children:[e.jsx(A,{icon:U.date,size:"sm",className:"me-1"}),"Incident Date"]}),e.jsx("p",{children:ne(t.incidentDate)})]}),e.jsxs(d,{sm:6,children:[e.jsxs("h6",{className:"text-muted",children:[e.jsx(A,{icon:U.location,size:"sm",className:"me-1"}),"Location"]}),e.jsx("p",{children:t.location})]})]}),t.injuryType&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted",children:"Injury Details"}),e.jsxs($,{children:[e.jsxs(I,{children:[e.jsx("strong",{children:"Injury Type:"})," ",t.injuryType]}),e.jsxs(I,{children:[e.jsx("strong",{children:"Medical Treatment Provided:"})," ",t.medicalTreatmentProvided?"Yes":"No"]}),e.jsxs(I,{children:[e.jsx("strong",{children:"Emergency Services Contacted:"})," ",t.emergencyServicesContacted?"Yes":"No"]})]})]}),t.witnessNames&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted",children:"Witness Information"}),e.jsx("p",{children:t.witnessNames})]}),t.immediateActionsTaken&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"text-muted",children:"Immediate Actions Taken"}),e.jsx("p",{children:t.immediateActionsTaken})]})]}),e.jsx(d,{md:4,children:e.jsxs("div",{className:"border-start ps-4",children:[e.jsx("h6",{className:"text-muted mb-3",children:"Reporter Information"}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{icon:U.reporter,size:"sm",className:"me-2"}),e.jsx("strong",{children:t.reporterName})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("small",{className:"text-muted",children:["Email: ",t.reporterEmail]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("small",{className:"text-muted",children:["Department: ",t.reporterDepartment]})}),e.jsx("h6",{className:"text-muted mb-3",children:"Related Information"}),e.jsxs($,{className:"mb-4 related-info-mobile",children:[e.jsxs(I,{className:"d-flex justify-content-between cursor-pointer position-relative",onClick:()=>N(!0),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),N(!0))},children:[e.jsxs("div",{children:[e.jsx("span",{children:"Attachments"}),e.jsx("small",{className:"d-block text-muted",children:"Photos, videos, documents"})]}),e.jsx(P,{color:"info",children:t.attachmentsCount||0})]}),e.jsxs(I,{className:"d-flex justify-content-between cursor-pointer position-relative",onClick:()=>g(!0),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),g(!0))},children:[e.jsxs("div",{children:[e.jsx("span",{children:"Involved Persons"}),e.jsx("small",{className:"d-block text-muted",children:"Formally linked individuals"})]}),e.jsx(P,{color:"info",children:((u=t.involvedPersons)==null?void 0:u.length)||0})]}),e.jsxs(I,{className:"d-flex justify-content-between cursor-pointer position-relative",onClick:()=>o(!0),style:{cursor:"pointer"},role:"button",tabIndex:0,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),o(!0))},children:[e.jsxs("div",{children:[e.jsx("span",{children:"Corrective Actions"}),e.jsx("small",{className:"d-block text-muted",children:"Assigned CAPA tasks"})]}),e.jsx(P,{color:"info",children:t.correctiveActionsCount||0})]})]}),t.attachmentsCount===0&&((y=t.involvedPersons)==null?void 0:y.length)===0&&t.correctiveActionsCount===0&&e.jsxs(He,{color:"info",className:"small mb-4",children:[e.jsx("strong",{children:"Note:"})," File uploads, formal person assignments, and corrective actions are typically added during the investigation phase.",e.jsx("div",{className:"mt-2",children:e.jsx(h,{color:"primary",size:"sm",variant:"outline",onClick:()=>g(!0),children:"Add Involved Persons"})})]}),e.jsx("h6",{className:"text-muted mb-3",children:"Audit Information"}),e.jsxs("div",{className:"small text-muted",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created:"})," ",ne(t.createdAt)]}),t.createdBy&&e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created By:"})," ",t.createdBy]}),t.lastModifiedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Modified:"})," ",ne(t.lastModifiedAt)]}),t.lastModifiedBy&&e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Modified By:"})," ",t.lastModifiedBy]})]})]})]})})]})})]})})}),t&&e.jsx(C,{children:e.jsx(d,{xs:12,children:e.jsx(oe,{incidentId:t.id,allowEdit:!0})})}),t&&e.jsx(C,{children:e.jsx(d,{xs:12,children:e.jsx(Ye,{incidentId:t.id})})}),e.jsxs(_,{visible:l,onClose:()=>N(!1),size:"lg",children:[e.jsx(Y,{children:e.jsx(L,{children:"Manage Attachments"})}),e.jsx(J,{children:t&&e.jsx($e,{incidentId:t.id,allowUpload:!0,allowDelete:!0})})]}),e.jsxs(_,{visible:n,onClose:()=>o(!1),size:"xl",children:[e.jsx(Y,{children:e.jsx(L,{children:"Manage Corrective Actions"})}),e.jsx(J,{children:t&&e.jsx(oe,{incidentId:t.id,allowEdit:!0})})]}),t&&e.jsx(Qe,{visible:p,onClose:()=>g(!1),incidentId:t.id,involvedPersons:t.involvedPersons||[],onAdd:async(r,x,f)=>{await E({incidentId:t.id,data:{personId:r,involvementType:x,injuryDescription:f}}).unwrap()},onUpdate:async(r,x,f)=>{await k({incidentId:t.id,personId:r,data:{involvementType:x,injuryDescription:f}}).unwrap()},onRemove:async r=>{await R({incidentId:t.id,personId:r}).unwrap()}})]})};export{is as default};
