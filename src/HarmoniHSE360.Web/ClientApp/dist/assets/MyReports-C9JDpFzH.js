import{Z as D,j as e,F as y,A as i,C as F}from"./index-CEPkdG4-.js";import{u as E,r as x}from"./react-vendor-CTgry22P.js";import{I as l}from"./Icon-B4fkNQKE.js";import{g as H,a as $}from"./incidentUtils-Bj1-pRjt.js";import{u as G,v as O,b as a,x as k,y as h,A as L,B as U,D as Y,G as _,H as K,I as Q,Q as w,K as V,R as X,S as W,T as z,U as o,V as Z,W as c,X as q,Y as N}from"./coreui-vendor-BHlqdV6q.js";import{f as J}from"./dateUtils-BKWPuADf.js";import"./redux-vendor-CopoOshl.js";const le=()=>{const m=E(),[t,d]=x.useState(1),[f]=x.useState(10),[p,S]=x.useState(""),[C,b]=x.useState(""),[v,T]=x.useState(""),{data:r,isLoading:M,error:R,refetch:I}=D({pageNumber:t,pageSize:f,searchTerm:p||void 0,status:C||void 0,severity:v||void 0}),A=()=>{d(1),I()},P=()=>{S(""),b(""),T(""),d(1)},g=(r==null?void 0:r.incidents)||[],j=(r==null?void 0:r.totalCount)||0,n=Math.ceil(j/f);return M&&!r?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(G,{size:"sm",className:"text-primary"}),e.jsx("span",{className:"ms-2",children:"Loading your reports..."})]}):R?e.jsxs(O,{color:"danger",children:["Failed to load your reports. Please try again.",e.jsx("div",{className:"mt-3",children:e.jsxs(a,{color:"primary",onClick:()=>I(),children:[e.jsx(y,{icon:i.refresh,className:"me-2"}),"Retry"]})})]}):e.jsx(k,{children:e.jsx(h,{xs:12,children:e.jsxs(L,{className:"shadow-sm",children:[e.jsxs(U,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-0",style:{color:"var(--harmoni-charcoal)",fontFamily:"Poppins, sans-serif"},children:[e.jsx(y,{icon:F.reports,size:"lg",className:"me-2 text-primary"}),"My Incident Reports"]}),e.jsxs("small",{className:"text-muted",children:[j," report",j!==1?"s":""," found"]})]}),e.jsxs(a,{color:"primary",onClick:()=>m("/incidents/create"),className:"d-flex align-items-center",children:[e.jsx(l,{icon:i.create,size:"sm",className:"me-2"}),"Report New Incident"]})]}),e.jsxs(Y,{children:[e.jsxs(k,{className:"mb-4",children:[e.jsx(h,{md:4,children:e.jsxs(_,{children:[e.jsx(K,{children:e.jsx(l,{icon:i.search})}),e.jsx(Q,{type:"text",placeholder:"Search incidents...",value:p,onChange:s=>S(s.target.value),onKeyPress:s=>s.key==="Enter"&&A()})]})}),e.jsx(h,{md:2,children:e.jsxs(w,{value:C,onChange:s=>b(s.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"Reported",children:"Reported"}),e.jsx("option",{value:"UnderInvestigation",children:"Under Investigation"}),e.jsx("option",{value:"AwaitingAction",children:"Awaiting Action"}),e.jsx("option",{value:"Resolved",children:"Resolved"}),e.jsx("option",{value:"Closed",children:"Closed"})]})}),e.jsx(h,{md:2,children:e.jsxs(w,{value:v,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"",children:"All Severities"}),e.jsx("option",{value:"Critical",children:"Critical"}),e.jsx("option",{value:"Serious",children:"Serious"}),e.jsx("option",{value:"Moderate",children:"Moderate"}),e.jsx("option",{value:"Minor",children:"Minor"})]})}),e.jsxs(h,{md:4,className:"d-flex gap-2",children:[e.jsxs(a,{color:"primary",onClick:A,children:[e.jsx(l,{icon:i.search,size:"sm",className:"me-1"}),"Search"]}),e.jsx(a,{color:"secondary",variant:"outline",onClick:P,children:"Clear"})]})]}),g.length===0?e.jsxs(V,{color:"info",className:"text-center py-4",children:[e.jsx(y,{icon:F.incident,size:"2xl",className:"mb-3 text-muted"}),e.jsx("h5",{children:"No incidents found"}),e.jsx("p",{className:"text-muted mb-3",children:p||C||v?"No incidents match your current filters.":"You haven't reported any incidents yet."}),e.jsxs(a,{color:"primary",onClick:()=>m("/incidents/create"),children:[e.jsx(l,{icon:i.create,size:"sm",className:"me-2"}),"Report Your First Incident"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(X,{hover:!0,responsive:!0,className:"border",children:[e.jsx(W,{children:e.jsxs(z,{children:[e.jsx(o,{children:"Title"}),e.jsx(o,{children:"Severity"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Date"}),e.jsx(o,{children:"Location"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Z,{children:g.map(s=>e.jsxs(z,{children:[e.jsx(c,{children:e.jsxs("div",{children:[e.jsx("strong",{children:s.title}),s.description&&e.jsx("div",{className:"text-muted small",children:s.description.length>100?`${s.description.substring(0,100)}...`:s.description})]})}),e.jsx(c,{children:H(s.severity)}),e.jsx(c,{children:$(s.status)}),e.jsx(c,{children:e.jsx("small",{children:J(s.incidentDate)})}),e.jsx(c,{children:e.jsx("small",{children:s.location})}),e.jsx(c,{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx(a,{color:"info",variant:"outline",size:"sm",onClick:()=>m(`/incidents/${s.id}`),title:"View Details",children:e.jsx(l,{icon:i.view,size:"sm"})}),e.jsx(a,{color:"primary",variant:"outline",size:"sm",onClick:()=>m(`/incidents/${s.id}/edit`),title:"Edit",children:e.jsx(l,{icon:i.edit,size:"sm"})})]})})]},s.id))})]}),n>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(q,{children:[e.jsx(N,{disabled:t===1,onClick:()=>d(t-1),children:"Previous"}),Array.from({length:Math.min(5,n)},(s,B)=>{const u=Math.max(1,Math.min(n-4,t-2))+B;return e.jsx(N,{active:u===t,onClick:()=>d(u),children:u},u)}),e.jsx(N,{disabled:t===n,onClick:()=>d(t+1),children:"Next"})]})}),e.jsxs("div",{className:"mt-3 text-center text-muted small",children:["Showing ",g.length," of ",j," reports",n>1&&` (Page ${t} of ${n})`]})]})]})]})})})};export{le as default};
